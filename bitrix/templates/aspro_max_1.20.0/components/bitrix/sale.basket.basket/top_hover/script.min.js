var basketTimeout,totalSum,timerBasketUpdate=!1;function setQuantityFly(t,a,e){var o=BX("QUANTITY_INPUT_"+t).value,r=$("#QUANTITY_INPUT_"+t).data("float_ratio");a=r?parseFloat(a):parseInt(a,10);r&&(a=Math.round(a*arMaxOptions.JS_ITEM_CLICK.precisionFactor)/arMaxOptions.JS_ITEM_CLICK.precisionFactor),curValue=r?parseFloat(o):parseInt(o,10),curValue="up"==e?curValue+a:curValue-a,r&&(curValue=Math.round(curValue*arMaxOptions.JS_ITEM_CLICK.precisionFactor)/arMaxOptions.JS_ITEM_CLICK.precisionFactor),curValue<0&&(curValue=0),0<curValue&&(BX("QUANTITY_INPUT_"+t).value=curValue,BX("QUANTITY_INPUT_"+t).defaultValue=o,totalSum=0,$("#basket_line .basket_fly .item[data-id="+t+"]").each(function(t,a){id=$(a).attr("data-id"),count=BX("QUANTITY_INPUT_"+id).value,price=$(document).find("#basket_form input[name=item_price_"+id+"]").val(),sum=count*price,totalSum+=sum,$(document).find("#basket_form [data-id="+id+"] .summ .price").html(jsPriceFormat(sum))}),$("#basket_form .foot .wrap_prices .price:not(.discount)").html(jsPriceFormat(totalSum)),$("#basket_form .foot .wrap_prices div.discount").fadeTo("slow",.2),timerBasketUpdate&&(clearTimeout(timerBasketUpdate),timerBasketUpdate=!1),timerBasketUpdate=setTimeout(function(){updateQuantityFly("QUANTITY_INPUT_"+t,t,a),timerBasketUpdate=!1},700))}function updateQuantityFly(t,a,e,o){var r=BX(t).defaultValue,i=parseFloat(BX(t).value)||0;if(bValidChange=!1,i||(bValidChange=!1,BX(t).value=r),$("#"+t).hasClass("focus")&&(i-=i%e),i=e%1==0?parseInt(i):parseFloat(i).toFixed(1),isRealValue(BX("QUANTITY_SELECT_"+a)))var s,n=BX("QUANTITY_SELECT_"+a).options,u=n.length;for(;u--;)s=n[u],parseFloat(s.value).toFixed(2)==parseFloat(i).toFixed(2)&&(s.selected=!0);BX("QUANTITY_"+a).value=i,BX("QUANTITY_INPUT_"+a).value=i,$("form[name^=basket_form]").prepend('<input type="hidden" name="BasketRefresh" value="Y" />'),$.post(arMaxOptions.SITE_DIR+"ajax/basket_fly.php",$("form[name^=basket_form]").serialize(),$.proxy(function(t){0==timerBasketUpdate&&basketTop("reload"),$("form[name^=basket_form] input[name=BasketRefresh]").remove()}))}function delete_all_items(t,a,e){var o="delay"==t?"2":"1";"na"==t&&(o=4),$.post(arMaxOptions.SITE_DIR+"ajax/show_basket_fly.php","PARAMS="+$("#basket_form").find("input#fly_basket_params").val()+"&TYPE="+o+"&CLEAR_ALL=Y",$.proxy(function(t){basketTop("reload"),$(".in-cart").hide(),$(".in-cart").closest(".button_block").removeClass("wide"),$(".to-cart").show(),$(".to-cart").removeClass("clicked"),$(".counter_block").closest(".counter_block_inner").show(),$(".counter_block").show(),$(".wish_item.added").hide(),$(".wish_item:not(.added)").show(),$(".wish_item.to").show(),$(".wish_item.in").hide(),$(".banner_buttons.with_actions .wraps_buttons .basket_item_add").removeClass("added"),$(".banner_buttons.with_actions .wraps_buttons .wish_item_add").removeClass("added"),getActualBasket();BX.onCustomEvent("onCompleteAction",[{action:"loadBasket"}])}))}function deleteProduct(t,a,e,o){function r(t,a,e){arStatusBasketAspro={},$.post(arMaxOptions.SITE_DIR+"ajax/item.php","delete_item=Y&item="+e,$.proxy(function(t){basketTop("reload"),getActualBasket(),$(".to-cart[data-item="+e+"]").removeClass("clicked"),reloadBasketCounters()}))}var i=o.attr("product-id");checkCounters()?(delFromBasketCounter(e),setTimeout(function(){r(0,0,i)},100)):r(0,0,i)}function delayProduct(t,a,e){var o=e.attr("product-id");$.post(arMaxOptions.SITE_DIR+"ajax/item.php","wish_item=Y&item="+o+"&quantity="+e.find("#QUANTITY_"+t).val(),$.proxy(function(t){basketTop("reload"),getActualBasket(e.attr("data-iblockid")),$(".to-cart[data-item="+o+"]").removeClass("clicked"),arStatusBasketAspro={};BX.onCustomEvent("onCompleteAction",[{action:"loadBasket"}])}))}function addProduct(t,a,e){var o=e.attr("product-id");$.post(arMaxOptions.SITE_DIR+"ajax/item.php","add_item=Y&item="+o+"&quantity="+e.find("#QUANTITY_"+t).val(),$.proxy(function(t){basketTop("reload"),getActualBasket(e.attr("data-iblockid")),arStatusBasketAspro={};BX.onCustomEvent("onCompleteAction",[{action:"loadBasket"}])}))}function checkOutFly(t){t=t||window.event;var a=$(t.target).parent();return checkCounters("google")&&checkoutCounter(1,a.data("text"),a.data("href")),setTimeout(function(){location.href=a.data("href")},50),!0}